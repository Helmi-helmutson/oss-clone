#
# Spec file for oss-clone (@VERSION@)
# Copyright (c) 2018 Peter Varkoly <peter@varkoly.de> NÃ¼rnberg, Germany.  All rights reserved.
#

Name:		oss-clone
Summary:	OSS boot environment for cloning clients
Version:	@VERSION@
Release:	@RELEASE@
License:	GPL-3.0+
Vendor:		Dipl. Ing. Peter Varkoly, Germany
Packager:	peter@varkoly.de
Group:		Productivity/
Source:		%{name}.tar.bz2
BuildArch:	noarch
BuildRequires:  unzip
BuildRequires:  oss-base
BuildRequires:  installation-images-@OS@
BuildRoot:    %{_tmppath}/%{name}-root
Requires:	oss-base

%description
This package provides a boot environment based on the openSUSE installation initrd for cloning clients.

Authors:
--------
        peter@varkoly.de

%prep
%setup -n %{name}

%build
# just here to be complete

%install
make DESTDIR=%{buildroot} install


%pre
%service_add_pre xinetd.service
%service_add_pre vsftpd.service

%preun

%post
%service_add_post xinetd.service
%service_add_post vsftpd.service

# setup rights
if [ -d /home/groups ]
then
   /usr/sbin/oss_reset_itool_rights.sh
fi
exit 0

%postun

%files
%defattr(-,root,root)
%config /etc/xinetd.d/*
%config(noreplace) /srv/tftp/clouds.jpg
%dir /srv/tftp
/srv/tftp/bootlogo
%dir /srv/tftp/clone
/srv/tftp/clone/*
/srv/tftp/menu.c32
/srv/tftp/pxelinux.0
/srv/tftp/gfxboot.c32
/srv/tftp/chain.c32
/srv/tftp/elilo.conf
/srv/tftp/german.kbd
/srv/tftp/linuxrc.config_DEFAULT
/srv/tftp/font.fnt
/srv/tftp/pxelinux.cfg
/srv/tftp/pxelinux.cfg/default.in
/srv/tftp/linuxrc.config_DE
/srv/tftp/bootmenu
/srv/tftp/elilo.efi
/srv/itool
%dir /srv/ftp/itool/
%dir /srv/ftp/itool/scripts
/srv/ftp/itool/scripts/*
/usr/share/oss/templates/*.in
%defattr(-,root,root)
/usr/sbin/*
