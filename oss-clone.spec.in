#
# Spec file for oss-clone (@VERSION@)
# Copyright (c) Peter Varkoly <peter@varkoly.de> NÃ¼rnberg, Germany.  All rights reserved.
#

Name:		oss-clone
Summary:	OSS boot environment for cloning clients
Version:	@VERSION@
Release:	@RELEASE@
License:	GPL-3.0+
Vendor:		Dipl. Ing. Peter Varkoly, Germany
Url:		www.cephalix.eu
Packager:	peter@varkoly.de
Group:		Productivity/Networking/Boot/Servers
Source:		%{name}.tar.bz2
PreReq:         permissions
BuildRequires:  unzip
BuildRequires:  oss-base
BuildRequires:  -post-build-checks
#BuildRequires:  installation-images-@OS@
BuildRoot:    %{_tmppath}/%{name}-root
Requires:	oss-base

%description
This package provides a boot environment based on the openSUSE installation initrd for cloning clients.

Authors:
--------
        peter@varkoly.de

%prep
%setup -n %{name}

%build
# just here to be complete

%install
make DESTDIR=%{buildroot} VERSION=%{version} install

#%verifyscript
#%verify_permissions -e /srv/itool/ROOT/root
#%verify_permissions -e /srv/itool/config
#%verify_permissions -e /srv/itool/hwinfo
#%verify_permissions -e /srv/itool/images/manual

%pre
%service_add_pre xinetd.service
%service_add_pre vsftpd.service

%preun

%post
%service_add_post xinetd.service
%service_add_post vsftpd.service

# setup rights
if [ -d /home/groups ]
then
   /usr/sbin/oss_reset_itool_rights.sh
fi
#%set_permissions /srv/itool/ROOT/root
#%set_permissions /srv/itool/config
#%set_permissions /srv/itool/hwinfo
#%set_permissions /srv/itool/images/manual
exit 0

%postun

%files
%defattr(-,root,root)
%dir /etc/xinetd.d/
%dir /srv/tftp
%dir /srv/ftp
%config /etc/xinetd.d/*
%config(noreplace) /srv/tftp/clouds.jpg
/srv/tftp/bootlogo
%dir /srv/tftp/clone
%dir /srv/tftp/boot
%dir /srv/tftp/efi
/srv/tftp/clone/*
/srv/tftp/menu.c32
/srv/tftp/pxelinux.0
/srv/tftp/gfxboot.c32
/srv/tftp/chain.c32
/srv/tftp/german.kbd
/srv/tftp/linuxrc.config_DEFAULT
/srv/tftp/font.fnt
/srv/tftp/pxelinux.cfg
/srv/tftp/pxelinux.cfg/default.in
/srv/tftp/linuxrc.config_DE
/srv/tftp/bootmenu
/srv/tftp/efi/*
/srv/itool
%dir /srv/ftp/itool/
%dir /srv/ftp/itool/scripts
/srv/ftp/itool/scripts/*
/usr/share/oss/templates/*.in
%defattr(-,root,root)
/usr/sbin/*
